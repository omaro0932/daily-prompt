<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DailyPrompt</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    :root { 
      --bg1:#667eea;--bg2:#764ba2;--text:#fff;--card-bg:rgba(255,255,255,0.12);
      --accent:#f093fb;--secondary:#4facfe;--success:#00f2c3;--gold:#ffd700;
      --shadow:rgba(0,0,0,0.3);--glow:rgba(240,147,251,0.4);
    }
    body.dark { 
      --bg1:#0f0c29;--bg2:#302b63;--text:#fff;--card-bg:rgba(255,255,255,0.08);
      --accent:#ff6bcb;--secondary:#4facfe;--shadow:rgba(0,0,0,0.6);
    }
    body.cosmic { 
      --bg1:#232526;--bg2:#414345;--text:#fff;--card-bg:rgba(255,255,255,0.1);
      --accent:#f857a6;--secondary:#ff5858;
    }
    body.ocean { 
      --bg1:#2e3192;--bg2:#1bffff;--text:#fff;--card-bg:rgba(255,255,255,0.15);
      --accent:#00d4ff;--secondary:#7b2cbf;
    }
    body { 
      margin:0;font-family:'Inter',sans-serif;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      color:var(--text);min-height:100vh;overflow-x:hidden;
      transition:background 0.6s ease;position:relative;
    }
    #particles { position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;}
    .container { position:relative;z-index:1;max-width:500px;margin:0 auto;padding:20px; }
    
    .header { text-align:center;margin-bottom:20px;position:relative; }
    h1 { 
      font-size:2.8em;margin:10px 0;font-weight:800;
      background:linear-gradient(45deg,var(--accent),var(--secondary));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      background-clip:text;animation:slideDown 0.5s ease;
      text-shadow:0 0 30px var(--glow);
    }
    @keyframes slideDown { from{opacity:0;transform:translateY(-30px);} to{opacity:1;transform:translateY(0);} }
    
    .crown { font-size:2em;display:inline-block;animation:bounce 2s infinite; }
    @keyframes bounce { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-10px);} }
    
    .stats { 
      display:flex;justify-content:space-around;margin:20px 0;gap:10px;
      animation:fadeIn 0.6s ease 0.2s both;
    }
    .stat-card { 
      background:var(--card-bg);backdrop-filter:blur(15px);
      padding:15px;border-radius:16px;flex:1;text-align:center;
      box-shadow:0 8px 32px var(--shadow);border:1px solid rgba(255,255,255,0.1);
      transition:transform 0.3s ease;
    }
    .stat-card:hover { transform:translateY(-5px) scale(1.05); }
    .stat-value { font-size:2em;font-weight:700;color:var(--accent);display:block; }
    .stat-label { font-size:0.85em;opacity:0.9;margin-top:5px; }
    
    #promptCard { 
      background:var(--card-bg);backdrop-filter:blur(20px);
      padding:30px;border-radius:24px;min-height:180px;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      box-shadow:0 12px 48px var(--shadow), 0 0 0 1px rgba(255,255,255,0.1);
      margin:20px 0;position:relative;overflow:hidden;
      animation:fadeIn 0.6s ease 0.3s both;
      transition:all 0.4s ease;
    }
    #promptCard:hover { box-shadow:0 16px 64px var(--shadow), 0 0 40px var(--glow); }
    #promptCard::before {
      content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;
      background:radial-gradient(circle,rgba(255,255,255,0.1) 0%,transparent 70%);
      animation:rotate 8s linear infinite;pointer-events:none;
    }
    @keyframes rotate { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
    
    #prompt { 
      font-size:1.35em;line-height:1.5em;text-align:center;z-index:1;
      font-weight:600;letter-spacing:0.3px;
    }
    .prompt-category { 
      display:inline-block;padding:6px 14px;background:var(--accent);
      border-radius:20px;font-size:0.75em;margin-top:15px;font-weight:600;
      text-transform:uppercase;letter-spacing:1px;
    }
    
    .btn-group { display:flex;flex-direction:column;gap:12px;margin:20px 0; }
    .btn { 
      width:100%;padding:16px;border:none;border-radius:16px;
      font-size:1.05em;font-weight:700;cursor:pointer;
      box-shadow:0 6px 20px var(--shadow);
      transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
      position:relative;overflow:hidden;letter-spacing:0.5px;
    }
    .btn::before {
      content:'';position:absolute;top:50%;left:50%;width:0;height:0;
      border-radius:50%;background:rgba(255,255,255,0.3);
      transform:translate(-50%,-50%);transition:width 0.6s,height 0.6s;
    }
    .btn:active::before { width:300px;height:300px; }
    .btn-primary { 
      background:linear-gradient(135deg,var(--accent),var(--secondary));
      color:#fff;animation:fadeIn 0.6s ease 0.4s both;
    }
    .btn-primary:hover { transform:translateY(-3px) scale(1.02);box-shadow:0 12px 32px var(--glow); }
    .btn-secondary { 
      background:var(--card-bg);backdrop-filter:blur(10px);color:var(--text);
      border:2px solid rgba(255,255,255,0.2);animation:fadeIn 0.6s ease 0.5s both;
    }
    .btn-secondary:hover { transform:translateY(-2px);border-color:var(--accent); }
    
    .categories { 
      display:flex;gap:8px;flex-wrap:wrap;margin:20px 0;
      animation:fadeIn 0.6s ease 0.6s both;
    }
    .category-btn { 
      padding:10px 16px;border-radius:20px;border:2px solid rgba(255,255,255,0.2);
      background:var(--card-bg);backdrop-filter:blur(10px);color:var(--text);
      font-size:0.9em;cursor:pointer;transition:all 0.3s ease;font-weight:600;
    }
    .category-btn:hover { border-color:var(--accent);transform:scale(1.05); }
    .category-btn.active { 
      background:linear-gradient(135deg,var(--accent),var(--secondary));
      border-color:transparent;box-shadow:0 4px 12px var(--glow);
    }
    
    .achievement { 
      position:fixed;top:-100px;left:50%;transform:translateX(-50%);
      background:linear-gradient(135deg,var(--gold),#ffa500);
      color:#000;padding:20px 30px;border-radius:16px;
      box-shadow:0 12px 40px rgba(0,0,0,0.5);z-index:1000;
      font-weight:700;font-size:1.1em;transition:top 0.5s ease;
      display:flex;align-items:center;gap:12px;
    }
    .achievement.show { top:20px; }
    .achievement-icon { font-size:2em;animation:rotate 1s ease; }
    
    .theme-selector { 
      display:flex;gap:10px;justify-content:center;margin:20px 0;
      animation:fadeIn 0.6s ease 0.7s both;
    }
    .theme-btn { 
      width:50px;height:50px;border-radius:50%;cursor:pointer;
      border:3px solid transparent;transition:all 0.3s ease;
      box-shadow:0 4px 12px var(--shadow);
    }
    .theme-btn:hover { transform:scale(1.1);border-color:#fff; }
    .theme-btn.active { border-color:#fff;box-shadow:0 0 20px rgba(255,255,255,0.5); }
    .theme-gradient { background:linear-gradient(135deg,#667eea,#764ba2); }
    .theme-dark { background:linear-gradient(135deg,#0f0c29,#302b63); }
    .theme-cosmic { background:linear-gradient(135deg,#232526,#414345); }
    .theme-ocean { background:linear-gradient(135deg,#2e3192,#1bffff); }
    
    .favorites { 
      margin:25px 0;animation:fadeIn 0.6s ease 0.8s both;
    }
    .favorites-title { 
      font-size:1.3em;font-weight:700;margin-bottom:15px;
      display:flex;align-items:center;gap:8px;
    }
    .favorite-item { 
      background:var(--card-bg);backdrop-filter:blur(10px);
      padding:15px;border-radius:12px;margin:10px 0;
      display:flex;justify-content:space-between;align-items:center;
      box-shadow:0 4px 16px var(--shadow);transition:all 0.3s ease;
    }
    .favorite-item:hover { transform:translateX(5px); }
    .delete-btn { 
      background:rgba(255,0,0,0.2);border:none;color:#ff4444;
      padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600;
    }
    
    .timer { 
      font-size:3em;font-weight:800;text-align:center;margin:20px 0;
      color:var(--accent);text-shadow:0 0 20px var(--glow);
      font-variant-numeric:tabular-nums;
    }
    
    @keyframes fadeIn { from{opacity:0;transform:translateY(20px);} to{opacity:1;transform:translateY(0);} }
    @keyframes pulse { 0%,100%{transform:scale(1);} 50%{transform:scale(1.05);} }
    
    #confetti { position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999; }
    
    .leaderboard { 
      background:var(--card-bg);backdrop-filter:blur(20px);
      padding:20px;border-radius:16px;margin:20px 0;
      box-shadow:0 8px 32px var(--shadow);
    }
    .leaderboard-title { font-size:1.5em;font-weight:700;margin-bottom:15px;text-align:center; }
    .leaderboard-item { 
      display:flex;justify-content:space-between;padding:12px;
      border-bottom:1px solid rgba(255,255,255,0.1);
    }
    .leaderboard-rank { font-weight:700;color:var(--gold);font-size:1.2em; }
    
    .modal { 
      display:none;position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,0.8);z-index:2000;align-items:center;justify-content:center;
    }
    .modal.show { display:flex; }
    .modal-content { 
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      padding:30px;border-radius:24px;max-width:400px;width:90%;
      box-shadow:0 20px 60px rgba(0,0,0,0.5);animation:slideDown 0.4s ease;
    }
    .modal-close { 
      background:rgba(255,255,255,0.2);border:none;color:#fff;
      padding:10px 20px;border-radius:12px;cursor:pointer;margin-top:20px;
      width:100%;font-weight:700;font-size:1em;
    }
  </style>
</head>
<body>

<canvas id="confetti"></canvas>
<div id="particles"></div>

<div class="container">
  <div class="header">
    <span class="crown">üëë</span>
    <h1>DailyPrompt</h1>
    <p style="opacity:0.9;margin:0;">Spark your creativity daily</p>
  </div>
  
  <div class="stats">
    <div class="stat-card">
      <span class="stat-value" id="streakCount">0</span>
      <span class="stat-label">üî• Day Streak</span>
    </div>
    <div class="stat-card">
      <span class="stat-value" id="totalPrompts">0</span>
      <span class="stat-label">‚ú® Prompts</span>
    </div>
    <div class="stat-card">
      <span class="stat-value" id="level">1</span>
      <span class="stat-label">‚≠ê Level</span>
    </div>
  </div>
  
  <div class="categories">
    <button class="category-btn active" data-category="all">All</button>
    <button class="category-btn" data-category="creative">Creative</button>
    <button class="category-btn" data-category="writing">Writing</button>
    <button class="category-btn" data-category="art">Art</button>
    <button class="category-btn" data-category="challenge">Challenge</button>
    <button class="category-btn" data-category="funny">Funny</button>
  </div>
  
  <div id="promptCard">
    <div id="prompt">Tap "Get Inspired!" to receive your creative prompt ‚ú®</div>
    <span class="prompt-category" id="promptCategory" style="display:none;">CREATIVE</span>
  </div>
  
  <div class="btn-group">
    <button class="btn btn-primary" id="surpriseBtn">üé≤ Get Inspired!</button>
    <button class="btn btn-secondary" id="favoriteBtn">‚≠ê Save to Favorites</button>
    <button class="btn btn-secondary" id="shareBtn">üì§ Share Prompt</button>
    <button class="btn btn-secondary" id="challengeBtn">‚ö° 60-Second Challenge</button>
    <button class="btn btn-secondary" id="leaderboardBtn">üèÜ View Leaderboard</button>
  </div>
  
  <div class="theme-selector">
    <div class="theme-btn theme-gradient active" data-theme="default"></div>
    <div class="theme-btn theme-dark" data-theme="dark"></div>
    <div class="theme-btn theme-cosmic" data-theme="cosmic"></div>
    <div class="theme-btn theme-ocean" data-theme="ocean"></div>
  </div>
  
  <div class="favorites">
    <div class="favorites-title">üíñ My Favorites</div>
    <div id="favoritesList"></div>
  </div>
</div>

<div class="achievement" id="achievement">
  <span class="achievement-icon">üèÜ</span>
  <span id="achievementText">Achievement Unlocked!</span>
</div>

<div class="modal" id="challengeModal">
  <div class="modal-content">
    <h2 style="text-align:center;margin-top:0;">‚ö° 60-Second Challenge!</h2>
    <p style="text-align:center;font-size:1.1em;" id="challengePrompt"></p>
    <div class="timer" id="timer">60</div>
    <button class="btn btn-primary" id="startChallenge">Start Challenge!</button>
    <button class="modal-close" id="closeChallenge">Close</button>
  </div>
</div>

<div class="modal" id="leaderboardModal">
  <div class="modal-content">
    <div class="leaderboard">
      <div class="leaderboard-title">üèÜ Global Leaderboard</div>
      <div id="leaderboardList"></div>
    </div>
    <button class="modal-close" id="closeLeaderboard">Close</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/tsparticles@2.11.1/tsparticles.bundle.min.js"></script>
<script>
  // Particle effects
  tsParticles.load("particles",{
    particles:{
      number:{value:60},
      size:{value:3,random:true},
      move:{speed:1.5,direction:"none",random:true,outModes:"out"},
      links:{enable:true,distance:150,opacity:0.3},
      color:{value:["#f093fb","#4facfe","#00f2c3"]},
      opacity:{value:0.6,random:true}
    }
  });
  
  // Enhanced prompts with categories
  const prompts = {
    creative: [
      "Design a new emoji that represents 2025",
      "Invent a new sport that combines two existing ones",
      "Create a superhero whose power is based on your favorite food",
      "Design your dream treehouse in 5 words",
      "Invent a holiday celebration for introverts"
    ],
    writing: [
      "Write a story that ends with: 'And that's why I never trust mirrors'",
      "Describe your morning routine as an epic adventure",
      "Write a love letter from your future self",
      "Create a haiku about your wifi connection",
      "Write the opening line of a bestselling novel"
    ],
    art: [
      "Draw your mood using only geometric shapes",
      "Create a logo for a company that sells bottled dreams",
      "Design a tattoo that tells your life story",
      "Sketch an alien's interpretation of human fashion",
      "Illustrate a sound using only colors"
    ],
    challenge: [
      "Explain quantum physics using only food metaphors",
      "Pitch a movie idea in exactly 7 words",
      "Create a recipe for happiness (literal ingredients)",
      "Write a breakup letter to your phone",
      "Describe a color to someone who's never seen"
    ],
    funny: [
      "Write Yelp review for Earth from an alien tourist",
      "Create dating profile bio for a houseplant",
      "Write warning label for being an adult",
      "Pitch worst product idea that could actually sell",
      "Explain your job to a time traveler from 1823"
    ]
  };
  
  // State management - uses window.storage if available, falls back to memory
  let state = {
    streak: 0,
    totalPrompts: 0,
    level: 1,
    currentPrompt: "",
    currentCategory: "all",
    favorites: [],
    achievements: [],
    lastDate: null,
    theme: "default",
    leaderboard: [],
    lastBonus: null
  };
  
  // Check if we're in Farcaster environment with storage
  const hasStorage = typeof window.storage !== 'undefined';
  
  // DOM elements
  const el = {
    prompt: document.getElementById("prompt"),
    category: document.getElementById("promptCategory"),
    streakCount: document.getElementById("streakCount"),
    totalPrompts: document.getElementById("totalPrompts"),
    level: document.getElementById("level"),
    favoritesList: document.getElementById("favoritesList"),
    achievement: document.getElementById("achievement"),
    achievementText: document.getElementById("achievementText"),
    challengeModal: document.getElementById("challengeModal"),
    leaderboardModal: document.getElementById("leaderboardModal"),
    timer: document.getElementById("timer"),
    challengePrompt: document.getElementById("challengePrompt")
  };
  
  // Storage wrapper
  async function loadState() {
    if (!hasStorage) {
      console.log('Using in-memory storage (deploy to Farcaster for persistence)');
      return;
    }
    
    try {
      const saved = await window.storage.get('dailyprompt-state');
      if (saved && saved.value) {
        const data = JSON.parse(saved.value);
        state = {...state, ...data};
      }
      
      const lb = await window.storage.get('dailyprompt-leaderboard', true);
      if (lb && lb.value) {
        state.leaderboard = JSON.parse(lb.value);
      }
    } catch (err) {
      console.log('No saved state');
    }
  }
  
  async function saveState() {
    if (!hasStorage) return;
    
    try {
      await window.storage.set('dailyprompt-state', JSON.stringify(state));
    } catch (err) {
      console.error('Save failed:', err);
    }
  }
  
  async function updateLeaderboard() {
    if (!hasStorage) return;
    
    try {
      const lb = await window.storage.get('dailyprompt-leaderboard', true);
      let leaderboard = lb && lb.value ? JSON.parse(lb.value) : [];
      
      const userIndex = leaderboard.findIndex(u => u.id === 'user');
      const userData = {
        id: 'user',
        name: 'You',
        streak: state.streak,
        prompts: state.totalPrompts,
        level: state.level,
        score: state.streak * 10 + state.totalPrompts * 5
      };
      
      if (userIndex >= 0) {
        leaderboard[userIndex] = userData;
      } else {
        leaderboard.push(userData);
      }
      
      leaderboard.sort((a, b) => b.score - a.score);
      leaderboard = leaderboard.slice(0, 10);
      
      await window.storage.set('dailyprompt-leaderboard', JSON.stringify(leaderboard), true);
      state.leaderboard = leaderboard;
    } catch (err) {
      console.error('Leaderboard update failed:', err);
    }
  }
  
  function updateUI() {
    el.streakCount.textContent = state.streak;
    el.totalPrompts.textContent = state.totalPrompts;
    el.level.textContent = state.level;
    
    el.favoritesList.innerHTML = state.favorites.length === 0 
      ? '<p style="text-align:center;opacity:0.6;">No favorites yet</p>'
      : state.favorites.map((fav, i) => `
          <div class="favorite-item">
            <span>${fav}</span>
            <button class="delete-btn" onclick="deleteFavorite(${i})">‚úï</button>
          </div>
        `).join('');
  }
  
  function getRandomPrompt(category) {
    let pool = [];
    if (category === 'all') {
      pool = Object.values(prompts).flat();
    } else {
      pool = prompts[category] || [];
    }
    return pool[Math.floor(Math.random() * pool.length)];
  }
  
  function updateStreak() {
    const today = new Date().toISOString().slice(0, 10);
    if (state.lastDate !== today) {
      const yesterday = new Date(Date.now() - 86400000).toISOString().slice(0, 10);
      if (state.lastDate === yesterday) {
        state.streak++;
        checkAchievements('streak', state.streak);
      } else if (state.lastDate !== null) {
        state.streak = 1;
      } else {
        state.streak = 1;
      }
      state.lastDate = today;
    }
  }
  
  function checkAchievements(type, value) {
    const achievements = {
      streak: [
        { at: 3, msg: "3 Day Streak! You're on fire! üî•" },
        { at: 7, msg: "Week Warrior! 7 days strong! üí™" },
        { at: 30, msg: "Monthly Master! 30 days! üèÜ" }
      ],
      prompts: [
        { at: 10, msg: "10 Prompts! Getting creative! ‚ú®" },
        { at: 50, msg: "50 Prompts! Inspiration machine! üé®" },
        { at: 100, msg: "Century Club! 100 prompts! üëë" }
      ],
      level: [
        { at: 5, msg: "Level 5! Rising star! ‚≠ê" },
        { at: 10, msg: "Level 10! Creative genius! üåü" }
      ]
    };
    
    const checks = achievements[type] || [];
    checks.forEach(ach => {
      const key = `${type}_${ach.at}`;
      if (value === ach.at && !state.achievements.includes(key)) {
        state.achievements.push(key);
        showAchievement(ach.msg);
        launchConfetti();
      }
    });
  }
  
  function showAchievement(msg) {
    el.achievementText.textContent = msg;
    el.achievement.classList.add('show');
    setTimeout(() => el.achievement.classList.remove('show'), 3000);
  }
  
  function launchConfetti() {
    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    
    const pieces = [];
    const colors = ['#f093fb', '#4facfe', '#00f2c3', '#ffd700', '#ff6bcb'];
    
    for (let i = 0; i < 100; i++) {
      pieces.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height - canvas.height,
        rotation: Math.random() * 360,
        speed: 2 + Math.random() * 3,
        color: colors[Math.floor(Math.random() * colors.length)]
      });
    }
    
    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      pieces.forEach((p, i) => {
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rotation * Math.PI / 180);
        ctx.fillStyle = p.color;
        ctx.fillRect(-5, -5, 10, 10);
        ctx.restore();
        
        p.y += p.speed;
        p.rotation += 5;
        
        if (p.y > canvas.height) pieces.splice(i, 1);
      });
      
      if (pieces.length > 0) requestAnimationFrame(animate);
    }
    animate();
  }
  
  // Event listeners
  document.getElementById('surpriseBtn').addEventListener('click', () => {
    const prompt = getRandomPrompt(state.currentCategory);
    state.currentPrompt = prompt;
    
    el.prompt.style.opacity = 0;
    el.category.style.display = 'none';
    
    setTimeout(() => {
      el.prompt.textContent = prompt;
      el.category.textContent = state.currentCategory.toUpperCase();
      el.category.style.display = 'inline-block';
      el.prompt.style.opacity = 1;
      
      updateStreak();
      state.totalPrompts++;
      state.level = Math.floor(state.totalPrompts / 10) + 1;
      checkAchievements('prompts', state.totalPrompts);
      checkAchievements('level', state.level);
      updateUI();
      saveState();
      updateLeaderboard();
    }, 200);
  });
  
  document.getElementById('favoriteBtn').addEventListener('click', () => {
    if (state.currentPrompt && !state.favorites.includes(state.currentPrompt)) {
      state.favorites.push(state.currentPrompt);
      updateUI();
      saveState();
      showAchievement("Added to favorites! üíñ");
    }
  });
  
  document.getElementById('shareBtn').addEventListener('click', () => {
    if (navigator.share) {
      navigator.share({
        title: 'DailyPrompt',
        text: state.currentPrompt || 'Check out DailyPrompt for creative inspiration!'
      });
    } else {
      navigator.clipboard.writeText(state.currentPrompt);
      showAchievement("Copied to clipboard! üìã");
    }
  });
  
  window.deleteFavorite = (index) => {
    state.favorites.splice(index, 1);
    updateUI();
    saveState();
  };
  
  document.querySelectorAll('.category-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      state.currentCategory = btn.dataset.category;
    });
  });
  
  document.querySelectorAll('.theme-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const theme = btn.dataset.theme;
      document.body.className = theme === 'default' ? '' : theme;
      state.theme = theme;
      saveState();
    });
  });
  
  let challengeInterval;
  document.getElementById('challengeBtn').addEventListener('click', () => {
    const prompt = getRandomPrompt('challenge');
    el.challengePrompt.textContent = prompt;
    el.timer.textContent = '60';
    el.challengeModal.classList.add('show');
  });
  
  document.getElementById('startChallenge').addEventListener('click', () => {
    let time = 60;
    const startBtn = document.getElementById('startChallenge');
    startBtn.disabled = true;
    startBtn.textContent = 'Challenge Running...';
    
    challengeInterval = setInterval(() => {
      time--;
      el.timer.textContent = time;
      
      if (time <= 0) {
        clearInterval(challengeInterval);
        showAchievement("Challenge complete! You're amazing! üéâ");
        launchConfetti();
        el.challengeModal.classList.remove('show');
        startBtn.disabled = false;
        startBtn.textContent = 'Start Challenge!';
        state.totalPrompts++;
        updateUI();
        saveState();
        updateLeaderboard();
      }
    }, 1000);
  });
  
  document.getElementById('closeChallenge').addEventListener('click', () => {
    clearInterval(challengeInterval);
    el.challengeModal.classList.remove('show');
    const startBtn = document.getElementById('startChallenge');
    startBtn.disabled = false;
    startBtn.textContent = 'Start Challenge!';
  });
  
  document.getElementById('leaderboardBtn').addEventListener('click', async () => {
    await updateLeaderboard();
    
    const leaderboardHTML = state.leaderboard.length > 0 
      ? state.leaderboard.map((user, i) => {
          const medal = i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : `#${i + 1}`;
          return `
            <div class="leaderboard-item">
              <span><span class="leaderboard-rank">${medal}</span> ${user.name}</span>
              <span style="font-weight:700;">${user.score} pts</span>
            </div>
          `;
        }).join('')
      : '<p style="text-align:center;opacity:0.8;">Be the first on the leaderboard!</p>';
    
    document.getElementById('leaderboardList').innerHTML = leaderboardHTML;
    el.leaderboardModal.classList.add('show');
  });
  
  document.getElementById('closeLeaderboard').addEventListener('click', () => {
    el.leaderboardModal.classList.remove('show');
  });
  
  function checkDailyBonus() {
    const today = new Date().toISOString().slice(0, 10);
    const lastBonus = state.lastBonus || null;
    
    if (lastBonus !== today) {
      setTimeout(() => {
        showAchievement("Daily Bonus! +10 XP for coming back! üéÅ");
        state.lastBonus = today;
        saveState();
      }, 2000);
    }
  }
  
  // Initialize
  loadState().then(() => {
    updateUI();
    if (state.theme !== 'default') {
      document.body.className = state.theme;
      const themeBtn = document.querySelector(`[data-theme="${state.theme}"]`);
      if (themeBtn) {
        document.querySelector('[data-theme="default"]').classList.remove('active');
        themeBtn.classList.add('active');
      }
    }
    checkDailyBonus();
  });
  
  setInterval(saveState, 30000);
</script>

<!-- Farcaster SDK -->
<script src="https://cdn.jsdelivr.net/npm/@farcaster/frame-sdk/dist/index.min.js"></script>
<script>
  function initSDK() {
    if (window.frame?.sdk?.actions?.ready) {
      try {
        window.frame.sdk.actions.ready();
        console.log("‚úÖ Farcaster SDK ready");
      } catch (err) {
        console.error("‚ùå SDK error:", err);
      }
    } else {
      setTimeout(initSDK, 100);
    }
  }
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSDK);
  } else {
    initSDK();
  }
</script>

</body>
</html>
